# チャット吹き出しデザイン切り替えの要件定義書

## 概要

ユーザーがチャット画面の吹き出しデザインを「四角」と「角削り」の 2 つから選択できる機能を提供する。選択したデザインは永続化され、次回起動時にも適用される。

## 背景

現在、チャット画面の吹き出しは角がほぼ四角い固定デザインとなっている。ユーザーによって好みのデザインが異なるため、選択可能にすることでユーザー体験を向上させる。

## ユーザーストーリー

### 好みのデザインを選択したい

ユーザーとして、チャット吹き出しのデザインを「四角」または「角削り」から選択したい。なぜならば、自分の好みに合った見た目でチャットを楽しめるだ。

受入基準:

- 2 つのデザインタイプから選択できる
  - 四角: 角がシャープな吹き出しデザイン（現在のデザイン）
  - 角削り: 角が丸みを帯びた吹き出しデザイン
- 選択したデザインは、ユーザーの送信メッセージ、AI の返信メッセージ、システムメッセージの全ての吹き出しに適用される

### 選択したデザインをプレビューで確認したい

ユーザーとして、デザインを変更する前にプレビューで確認したい。なぜならば、実際にどう見えるか分かった上で選択できるからだ。

受入基準:

- 選択ダイアログに各デザインの吹き出しサンプルが表示される
- プレビューは実際のチャット画面の吹き出しと同じ見た目である

### 選択したデザインを保持したい

ユーザーとして、一度選択したデザインがアプリ再起動後も保持したい。なぜならば、毎回設定し直す手間が省けるからだ。

受入基準:

- 選択したデザインは端末内に保存される
- アプリを再起動しても前回選択したデザインが適用される
- 初回起動時または設定未選択時は「四角」デザインがデフォルトとして適用される

### デザイン変更が即座に反映されることを期待する

ユーザーとして、デザインを変更したら即座にチャット画面に反映されてほしい。なぜならば、待ち時間なく変更結果を確認でき、快適に使えるからだ。

受入基準:

- デザイン選択ダイアログで「OK」をタップ後、即時チャット画面に反映される
- 既存のチャット履歴を含む全ての吹き出しが同時に更新される
- 画面のリロードや再起動は不要

### 全ての吹き出しで一貫したデザインであることを期待する

ユーザーとして、選択したデザインが全ての吹き出しに統一して適用されてほしい。なぜならば、見た目に一貫性があり、美しく感じられるからだ。

受入基準:

- ユーザーの送信メッセージ、AI の返信メッセージ、システムメッセージの全てに同じデザインが適用される
- 吹き出しの色、サイズ、配置などの他のデザイン要素には影響しない（角の形状のみ変更）
- 新しいメッセージも自動的に選択されたデザインで表示される

### 将来の機能拡張に対応できる設計であることを期待する

開発者として、新しいデザインタイプを簡単に追加できる設計にしたい。なぜならば、ユーザーの要望に応じて柔軟に機能を拡張できるからだ。

受入基準:

- 新しいデザインタイプは enum への追加とプロパティの実装のみで追加可能
- 既存のコードへの影響を最小限に抑えた実装である
- デザイン設定は他の表示設定（将来実装されるテーマ機能など）と独立して動作する

## UI 仕様

### 設定画面

```
┌─────────────────────────────────────┐
│ 設定                            ← │
├─────────────────────────────────────┤
│ ... (既存の設定項目)                │
├─────────────────────────────────────┤
│ 表示設定                            │
├─────────────────────────────────────┤
│ 💬  吹き出しデザイン                │
│     四角                       →   │
├─────────────────────────────────────┤
│ ... (その他の設定項目)              │
└─────────────────────────────────────┘
```

- アイコン: 💬 (チャット吹き出し)
- タイトル: "吹き出しデザイン"
- サブタイトル: 現在選択されているデザイン名（"四角" または "角削り"）
- タップで選択ダイアログを表示

### デザイン選択ダイアログ

```
┌─────────────────────────────────────┐
│ 吹き出しデザインの選択              │
├─────────────────────────────────────┤
│ ● 四角                              │
│   ┌─────────┐                       │
│   │ サンプル │ (角が四角い吹き出し) │
│   └─────────┘                       │
│                                     │
│ ○ 角削り                            │
│   ╭─────────╮                       │
│   │ サンプル │ (角が丸い吹き出し)   │
│   ╰─────────╯                       │
├─────────────────────────────────────┤
│                 キャンセル    OK   │
└─────────────────────────────────────┘
```

- ラジオボタンで選択（単一選択）
- 各選択肢にプレビュー用の吹き出しサンプルを表示
- 「キャンセル」ボタン: 変更を破棄してダイアログを閉じる
- 「OK」ボタン: 選択を確定して保存

## 関連ドキュメント

- [技術設計書: チャット吹き出しデザイン切り替え](../design/switch-design-feature.md)
- [SharedPreferences 使用時の設計方法](../how-to-design-when-using-shared-preferences.md)
