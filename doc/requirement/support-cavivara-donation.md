# カヴィヴァラ応援課金機能の要件定義書

## 概要

ユーザーがカヴィヴァラさんたちを「応援する」という体で、金銭的なサポートを行える機能を提供する。アプリの基本機能は無料のまま維持し、純粋な応援としての課金を実現する。

## 背景

現在、アプリは完全無料で提供されているが、継続的な開発・運営コスト（サーバー費用、AI API 費用など）をサポートする仕組みが必要である。機能制限による課金ではなく、「応援」という形での課金により、ユーザーとの良好な関係を維持しつつ収益化を図る。

## ユーザーストーリー

### 応援の気持ちを金銭的に表現したい

ユーザーとして、カヴィヴァラさんたちへの感謝や応援の気持ちを金銭的なサポートとして表現したい。なぜならば、良いサービスを提供してくれる開発者を支援することで、継続的な運営を後押しできるからだ。

受入基準:

- 3 つの金額プランから選択できる（¥120, ¥370, ¥610）
- 各金額に応じた応援メッセージが表示される
- 課金は都度課金（消費型）として実装される
- 全てのユーザーが応援可能（アプリの基本機能は無料のまま）

### 応援履歴を確認したい

ユーザーとして、これまでにどれくらい応援したかを確認したい。なぜならば、自分の貢献度を可視化することで、参加意識が高まるからだ。

受入基準:

- 応援画面に累計応援回数を表示
- 「〇〇回応援してくれたヴィヴァ！」などの感謝メッセージが表示される
- 応援履歴はローカルまたは Firestore に保存される

### 応援後に感謝を受け取りたい

ユーザーとして、応援した後にカヴィヴァラからの感謝メッセージを受け取りたい。なぜならば、応援が届いたことを実感でき、満足感が得られるからだ。

受入基準:

- 応援完了時に感謝のダイアログが表示される
- 「応援ありがとうヴィヴァ！」などのカヴィヴァラらしいメッセージ

### 課金しても機能が変わらないことを理解したい

ユーザーとして、応援課金が純粋なサポートであり、機能追加がないことを明確に理解したい。なぜならば、誤解なく納得した上で応援したいからだ。

受入基準:

- 応援画面に「応援課金では機能は追加されません」ことが明記される
- 「アプリの基本機能は引き続き無料でご利用いただけます」という説明
- 透明性のある説明で、ユーザーが安心して応援できる

## UI 仕様

### 設定画面からのアクセス

```
┌─────────────────────────────────────┐
│ 設定                            ← │
├─────────────────────────────────────┤
│ アカウント                          │
├─────────────────────────────────────┤
│ ...                                 │
├─────────────────────────────────────┤
│ アプリについて                      │
├─────────────────────────────────────┤
│ 💝  カヴィヴァラを応援              │
│     これまで3回応援            →   │
├─────────────────────────────────────┤
│ ...                                 │
└─────────────────────────────────────┘
```

- アイコン: 💝
- タイトル: "カヴィヴァラを応援"
- サブタイトル: これまでの応援回数（未応援時は表示なし）

### 応援画面のレイアウト

応援画面には以下を表示:

- カヴィヴァラのアイコンと説明文
- 応援金の使い道（サーバー運営費、新機能開発など）
- これまでの累計応援回数
- 3 つの応援プラン
- 注意書き（機能追加なし、基本機能は無料であることを明示）

### 応援プラン

| プラン名     | 金額 | メッセージ                       |
| ------------ | ---- | -------------------------------- |
| ちょっと応援 | ¥120 | 「頑張って！」                   |
| しっかり応援 | ¥370 | 「いつもありがとう！」           |
| めっちゃ応援 | ¥610 | 「これからも応援するヴィヴァ！」 |

※金額は日本円の例。各国の通貨に応じた価格設定が必要。

## 技術仕様

### 課金システム

- iOS: StoreKit 2（in_app_purchase プラグイン）
- Android: Google Play Billing Library（in_app_purchase プラグイン）
- 課金タイプ: 消費型アイテム（何度でも購入可能）

### プロダクト ID

- `support_120`, `support_370`, `support_610`

※実際のバンドル ID/パッケージ名のプレフィックスを追加

### データ管理

- 応援履歴: Firestore または SharedPreferences
- 保存内容: 累計応援回数、最終応援日時

## 制約事項

- 応援課金では機能は追加されない（純粋なサポート）
- アプリの基本機能は全て無料のまま提供
- App Store / Google Play のガイドライン準拠
  - 「寄付」「投げ銭」ではなく「応援」という表現を使用
  - 課金なしでも全機能が利用可能であることを明示
  - 機能追加がないことを明確に説明

## 関連ドキュメント

- [技術設計書: カヴィヴァラ応援課金機能](../design/support-cavivara-donation.md)（作成予定）
- [in_app_purchase plugin documentation](https://pub.dev/packages/in_app_purchase)
