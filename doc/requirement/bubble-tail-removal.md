# 吹き出しのツノ排除と角丸デザインの要件定義書

## 概要

チャット画面の吹き出しデザインにおいて、ツノ(tail)部分を排除し、角丸の仕様を細かく調整する。ツノがついた四隅は小さい角丸(radius 4)、他の四隅は大きい角丸(radius 10)とすることで、より洗練された見た目を実現する。

## 背景

現在の吹き出しデザインでは、全ての角に対して一律の角丸が適用されている。しかし、より洗練された UI デザインを実現するため、以下の改善が求められている:

- ツノ(tail)部分の排除
- 角ごとに異なる角丸の適用(ツノがあった部分は小さく、それ以外は大きく)

これにより、視認性を保ちつつ、モダンで洗練された印象を与えるデザインとなる。

## ユーザーストーリー

### より洗練された吹き出しデザインを見たい

ユーザーとして、チャット吹き出しのデザインをより洗練されたものにしたい。なぜならば、視覚的に快適で現代的な UI を好むからだ。

受入基準:

- ツノ(tail)部分が排除されている
- 従来ツノがついていた角: radius 4 程度の小さい角丸
- それ以外の角: radius 10 程度の大きい角丸
- ユーザーの送信メッセージ、AI の返信メッセージ、システムメッセージの全てに適用される

### 吹き出しの方向性を視覚的に理解したい

ユーザーとして、吹き出しの角丸の違いによって誰のメッセージかを自然に認識したい。なぜならば、ツノが無くても視覚的な手がかりがあると読みやすいからだ。

受入基準:

- ユーザーメッセージ: 右下の角が小さい角丸(radius 4)
- AI メッセージ: 左下の角が小さい角丸(radius 4)
- システムメッセージ: 対称的な角丸デザイン
- 小さい角丸により、従来のツノの名残として方向性が視覚的に示される

### 既存のデザイン選択機能との整合性を期待する

ユーザーとして、既存のデザイン選択機能(四角/角削り)との整合性を保ったデザイン変更を期待する。なぜならば、混乱なく機能を使い続けたいからだ。

受入基準:

- 「角削り」デザインが今回の新しい仕様に更新される
- 「四角」デザインは既存のまま維持される
- デザイン選択ダイアログのプレビューも新しいデザインで表示される
- 既存の設定値は引き続き有効である

## 技術仕様

### 角丸の詳細仕様

#### ユーザーメッセージの吹き出し

```
右寄せ配置

     radius 10 ╭──────────────╮ radius 10
               │ メッセージ   │
     radius 10 ╰──────────────╯ radius 4
                              ↑
                         従来のツノ位置
```

- 左上: radius 10
- 右上: radius 10
- 右下: radius 4 (従来ツノがあった位置)
- 左下: radius 10

#### AI メッセージの吹き出し

```
左寄せ配置

radius 10 ╭──────────────╮ radius 10
          │ メッセージ   │
radius 4 ╰──────────────╯ radius 10
    ↑
従来のツノ位置
```

- 左上: radius 10
- 右上: radius 10
- 右下: radius 10
- 左下: radius 4 (従来ツノがあった位置)

#### システムメッセージの吹き出し

```
中央配置

radius 10 ╭──────────────╮ radius 10
          │ メッセージ   │
radius 10 ╰──────────────╯ radius 10
```

- 全ての角: radius 10 (対称的なデザイン)

### 実装対象ファイル

- `client/lib/ui/component/chat_bubble_design_extension.dart`: BorderRadius の定義を変更
- `client/lib/ui/feature/home/home_screen.dart`: 吹き出しごとに適切な BorderRadius を適用
- `client/lib/ui/feature/settings/chat_bubble_design_selection_dialog.dart`: プレビュー表示を更新

### 既存のデザイン選択機能との関係

- `ChatBubbleDesign.square`: 変更なし(radius 2 の一律適用)
- `ChatBubbleDesign.rounded`: 今回の新仕様を適用(角ごとに異なる radius)

### 後方互換性

- 既存の `ChatBubbleDesign` enum は変更しない
- 既存のユーザー設定は引き続き有効
- `borderRadius` プロパティの返り値の型は変更しない(`BorderRadius`)

## UI 仕様

### デザイン選択ダイアログのプレビュー更新

```
┌─────────────────────────────────────┐
│ 吹き出しデザインの選択              │
├─────────────────────────────────────┤
│ ○ 四角                              │
│   ┌─────────┐                       │
│   │ サンプル │ (角が四角い)         │
│   └─────────┘                       │
│                                     │
│ ● 角削り                            │
│   ╭─────────╮                       │
│   │ サンプル │ (角ごとに異なる角丸) │
│   ╰────────╯                        │
├─────────────────────────────────────┤
│                 キャンセル    OK   │
└─────────────────────────────────────┘
```

- 「角削り」のプレビューは新しい角丸仕様を反映
- ユーザーメッセージと AI メッセージの両方のサンプルを表示し、角丸の違いが分かるようにする

## 非機能要件

### パフォーマンス

- 角丸の描画処理は Flutter の標準機能を使用するため、パフォーマンスへの影響は最小限
- 既存のデザイン切り替え機能と同等の応答速度を維持

### 保守性

- 各メッセージタイプごとに角丸を定義することで、将来的なデザイン変更に対応しやすい構造とする
- マジックナンバーを避け、定数として定義する

### アクセシビリティ

- 角丸の変更は視覚的な装飾のみであり、テキストの可読性やコントラストには影響しない
- スクリーンリーダーなどの支援技術には影響しない

## 制約事項

- iOS, Android 両プラットフォームで同一の見た目を保証する
- 既存のデザイン選択機能との互換性を維持する
- Flutter の `BorderRadius` クラスの機能範囲内で実装する

## 受入テスト

### 視覚的な確認

- [ ] ユーザーメッセージの右下角が radius 4 で表示される
- [ ] ユーザーメッセージの他の角が radius 10 で表示される
- [ ] AI メッセージの左下角が radius 4 で表示される
- [ ] AI メッセージの他の角が radius 10 で表示される
- [ ] システムメッセージの全ての角が radius 10 で表示される
- [ ] デザイン選択ダイアログのプレビューが新しい仕様を反映している

### 機能的な確認

- [ ] 「四角」デザインは変更されていない
- [ ] 「角削り」デザインを選択すると新しい角丸が適用される
- [ ] デザイン選択が永続化される
- [ ] アプリ再起動後も選択したデザインが保持される

### プラットフォーム横断

- [ ] iOS で正しく表示される
- [ ] Android で正しく表示される
- [ ] iOS/Android 間で見た目の差異がない

## 関連ドキュメント

- [要件定義書: チャット吹き出しデザイン切り替え](./switch-design.md)
- [技術設計書: チャット吹き出しデザイン切り替え](../design/switch-design-feature.md)
