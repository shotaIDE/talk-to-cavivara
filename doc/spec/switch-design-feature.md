# チャット吹き出しデザイン切り替えの要件定義書

## 概要

ユーザーがチャット画面の吹き出しデザインを「四角」と「角削り」の 2 つから選択できる機能を提供する。選択したデザインは永続化され、次回起動時にも適用される。

## 背景

現在、チャット画面の吹き出しは角がほぼ四角い固定デザインとなっている。ユーザーによって好みのデザインが異なるため、選択可能にすることでユーザー体験を向上させる。

## ユーザーストーリー

### US-1: 好みのデザインを選択したい

ユーザーとして、チャット吹き出しのデザインを「四角」または「角削り」から選択したい。なぜならば、自分の好みに合った見た目でチャットを楽しめるだ。

受入基準:

- 2 つのデザインタイプから選択できる
  - 四角: 角がシャープな吹き出しデザイン（現在のデザイン）
  - 角削り: 角が丸みを帯びた吹き出しデザイン
- 選択したデザインは、ユーザーの送信メッセージ、AI の返信メッセージ、システムメッセージの全ての吹き出しに適用される

### US-3: 選択したデザインをプレビューで確認したい

ユーザーとして、デザインを変更する前にプレビューで確認したい。なぜならば、実際にどう見えるか分かった上で選択できるからだ。

受入基準:

- 選択ダイアログに各デザインの吹き出しサンプルが表示される
- プレビューは実際のチャット画面の吹き出しと同じ見た目である

### US-4: 選択したデザインを保持したい

ユーザーとして、一度選択したデザインがアプリ再起動後も保持したい。なぜならば、毎回設定し直す手間が省けるからだ。

受入基準:

- 選択したデザインは端末内に保存される
- アプリを再起動しても前回選択したデザインが適用される
- 初回起動時または設定未選択時は「四角」デザインがデフォルトとして適用される

### NFR-1: パフォーマンス

- デザイン変更は即座に画面に反映される（リアルタイム更新）
- 既存のチャット履歴を含む全ての吹き出しが同時に更新される

### NFR-2: 一貫性

- 全ての吹き出しに同じデザインルールが適用される
- 吹き出しの色や配置などの他のデザイン要素には影響しない

### NFR-3: 拡張性

- 将来的に新しいデザインタイプを追加できる設計とする
- デザイン設定は他の表示設定（テーマなど）と独立して動作する

## UI 仕様

### 設定画面

```
┌─────────────────────────────────────┐
│ 設定                            ← │
├─────────────────────────────────────┤
│ ... (既存の設定項目)                │
├─────────────────────────────────────┤
│ 表示設定                            │
├─────────────────────────────────────┤
│ 💬  吹き出しデザイン                │
│     四角                       →   │
├─────────────────────────────────────┤
│ ... (その他の設定項目)              │
└─────────────────────────────────────┘
```

- アイコン: 💬 (チャット吹き出し)
- タイトル: "吹き出しデザイン"
- サブタイトル: 現在選択されているデザイン名（"四角" または "角削り"）
- タップで選択ダイアログを表示

### デザイン選択ダイアログ

```
┌─────────────────────────────────────┐
│ 吹き出しデザインの選択              │
├─────────────────────────────────────┤
│ ● 四角                              │
│   ┌─────────┐                       │
│   │ サンプル │ (角が四角い吹き出し) │
│   └─────────┘                       │
│                                     │
│ ○ 角削り                            │
│   ╭─────────╮                       │
│   │ サンプル │ (角が丸い吹き出し)   │
│   ╰─────────╯                       │
├─────────────────────────────────────┤
│                 キャンセル    OK   │
└─────────────────────────────────────┘
```

- ラジオボタンで選択（単一選択）
- 各選択肢にプレビュー用の吹き出しサンプルを表示
- 「キャンセル」ボタン: 変更を破棄してダイアログを閉じる
- 「OK」ボタン: 選択を確定して保存

## 現状の制限事項

本機能は初期実装であり、以下の制限があります。将来のバージョンで改善を検討します。

### 対象範囲の制限

**制限内容:**

- 吹き出しに付属する三角形のポインター（矢印）は角の形状変更の対象外
- チャット画面の提案カード（初回表示時のサジェスション）のデザインは変更の対象外

**理由:**

- ポインターは独立した描画ロジックで実装されており、今回の変更範囲外
- 提案カードは吹き出しとは別の UI コンポーネントで、統一性の検証が必要

**影響:**

- 角削りデザインを選択しても、ポインターは三角形のまま
- 提案カードは現在の角が四角いデザインのまま表示される

### デザインタイプの制限

**制限内容:**

- 選択可能なデザインタイプは「四角」と「角削り」の 2 種類のみ

**理由:**

- 初期実装として最小限の選択肢から開始
- ユーザーの反応を見てから追加のデザインタイプを検討

**影響:**

- より多様なデザインを求めるユーザーのニーズに応えられない可能性

### UI/UX の制限

**制限内容:**

- デザイン切り替え時のアニメーションなし（即座に切り替わる）

**理由:**

- 実装の複雑さを避け、基本機能の安定性を優先
- アニメーションの実装には追加の設計とテストが必要

**影響:**

- デザイン変更時に視覚的な連続性がなく、突然切り替わる

### 機能の制限

**制限内容:**

- 本機能は表示のみの変更であり、機能面での変更はない
- 吹き出しの色、サイズ、配置などの他の視覚要素のカスタマイズは不可

**理由:**

- スコープを明確にし、実装を簡素化
- 色やサイズの変更は別の機能として検討が必要

**影響:**

- より詳細なカスタマイズを求めるユーザーのニーズには対応できない

## 関連ドキュメント

- [技術設計書: チャット吹き出しデザイン切り替え](../design/switch-design-feature.md)
- [SharedPreferences 使用時の設計方法](../how-to-design-when-using-shared-preferences.md)
